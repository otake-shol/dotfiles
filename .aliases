# ========================================
# 基本操作
# ========================================

# ディレクトリ移動
alias ..="cd .."
alias ...="cd ../.."
alias ....="cd ../../.."
alias ~="cd ~"
alias -- -="cd -"
alias CD="cd"

# ls関連 (eza)
alias ls="eza"                    # モダンなls
alias ll="eza -l --git"           # 詳細表示+Git状態
alias っl="eza -l --git"          # 日本語入力時のtypo対策
alias la="eza -la --git"          # 隠しファイル含む
alias l="eza -1"                  # 1行1ファイル
alias lsd="eza -lD"               # ディレクトリのみ
alias lt="eza -T --git-ignore"    # ツリー表示
alias lta="eza -Ta"               # ツリー（全ファイル）

# 検索・grep
alias grep="grep --color=auto"
alias fgrep="fgrep --color=auto"
alias egrep="egrep --color=auto"
alias h="history | grep"

# ripgrep (高速grep)
alias rg="rg --smart-case"        # 大文字小文字自動判定
alias rgi="rg -i"                 # 常に大文字小文字無視
alias rgf="rg --files"            # ファイル名のみ表示

# fd (高速find)
alias fd="fd --hidden --exclude .git"  # 隠しファイル含む
alias fdi="fd -I"                      # gitignore無視して検索

# 安全な削除・コピー
alias cp="cp -i"
alias mv="mv -i"

# rm -rf 保護機能（確認プロンプト表示）
rm() {
  if [[ "$*" =~ "-rf" ]] || [[ "$*" =~ "-fr" ]]; then
    echo "⚠️  rm -rf を実行しようとしています:"
    echo "   rm $@"
    echo ""
    read "confirm?本当に実行しますか？ [y/N]: "
    if [[ "$confirm" =~ ^[Yy]$ ]]; then
      command rm "$@"
    else
      echo "キャンセルしました"
      return 1
    fi
  else
    command rm -i "$@"
  fi
}

# trash - ゴミ箱に移動（復元可能な安全な削除）
alias del="trash"
alias tp="trash -F"  # Finderのゴミ箱に移動

# ========================================
# Claude
# ========================================
alias c="claude"
alias cl="claude"

# ========================================
# Git
# ========================================
alias gs="git status"
alias ga="git add"
alias gc="git commit"
alias gcm="git commit -m"
alias gp="git push"
alias gpl="git pull"
alias gd="git diff"
alias gl="git log"
alias glg="git log --graph --oneline --decorate --all"
alias gco="git checkout"
alias gcb="git checkout -b"
alias gb="git branch"
alias gba="git branch -a"
alias gf="git fetch"
alias gm="git merge"
alias grb="git rebase"
alias gst="git stash"
alias gsta="git stash apply"
alias gundo="git reset --soft HEAD^"

# difftastic（構文認識diff）
alias gdd="GIT_EXTERNAL_DIFF=difft git diff"          # 構文ベースdiff
alias gdds="GIT_EXTERNAL_DIFF=difft git diff --staged" # ステージング済みの構文diff
alias gdlog="GIT_EXTERNAL_DIFF=difft git log -p"      # ログを構文diffで表示




# ========================================
# 開発ツール
# ========================================

# Tmux
alias tm="tmux a"

# Neovim
alias vi="nvim"
alias vim="nvim"
alias nview="nvim -R"              # nvim読み取り専用モード
alias view="bat"                   # 軽量ファイル閲覧（batに置き換え）

# Python
alias python="python3"
alias pip="pip3"
alias py="python3"

# Docker
alias d="docker"
alias dc="docker compose"          # Docker Compose v2
alias dcu="docker compose up"
alias dcd="docker compose down"
alias dcb="docker compose build"
alias dclogs="docker compose logs -f"
alias dps="docker ps"
alias dpa="docker ps -a"
alias di="docker images"
alias drm="docker rm"
alias drmi="docker rmi"
alias dstop="docker stop"
alias dstart="docker start"

# npm
alias ni="npm install"
alias nid="npm install --save-dev"
alias nig="npm install -g"
alias nr="npm run"
alias ns="npm start"
alias nt="npm test"

# yarn
alias yi="yarn install"
alias ya="yarn add"
alias yad="yarn add --dev"
alias yr="yarn run"
alias ys="yarn start"
alias yt="yarn test"

# pnpm
alias pn="pnpm"
alias pni="pnpm install"
alias pna="pnpm add"
alias pnad="pnpm add -D"
alias pnr="pnpm run"
alias pnx="pnpm dlx"

# bun（高速JS/TSランタイム）
alias b="bun"
alias bi="bun install"
alias ba="bun add"
alias bad="bun add -d"
alias br="bun run"
alias bt="bun test"
alias bx="bunx"

# Homebrew
alias brewup="brew update && brew upgrade && brew cleanup"
alias brewls="brew list"

# Kubernetes
alias k="kubectl"
alias kgp="kubectl get pods"
alias kgs="kubectl get services"
alias kgd="kubectl get deployments"
alias kl="kubectl logs -f"
alias kx="kubectl exec -it"
alias kctx="kubectl config use-context"
alias kns="kubectl config set-context --current --namespace"

# AWS
alias awswho="aws sts get-caller-identity"
alias awsregions="aws ec2 describe-regions --output table"

# Terraform
alias tf="terraform"
alias tfi="terraform init"
alias tfp="terraform plan"
alias tfa="terraform apply"
alias tfaa="terraform apply -auto-approve"
alias tfd="terraform destroy"
alias tfv="terraform validate"
alias tff="terraform fmt"
alias tfs="terraform state"
alias tfo="terraform output"
alias tfw="terraform workspace"

# ========================================
# システム・ネットワーク
# ========================================

# システム
alias reload="source ~/.zshrc"
alias zshconfig="vim ~/.zshrc"
alias aliasconfig="vim ~/.aliases"
alias ohmyzsh="vim ~/.oh-my-zsh"
alias zshtime="time zsh -i -c exit"  # zsh起動時間計測
alias path='echo -e ${PATH//:/\\n}'
alias his="history"
alias df="df -h"
alias top="top -o cpu"

# モダンCLIツール（従来コマンドの高機能代替）
alias du="dust"                    # ディスク使用量可視化
alias dui="dust -r"                # 逆順（小さい順）
alias ps="procs"                   # プロセス表示
alias pst="procs --tree"           # プロセスツリー
alias psg="procs --or"             # プロセス検索
alias sdr="sd"                     # sd (Rust製の高速置換) ※sedとは構文が異なる
alias bench="hyperfine"            # コマンドベンチマーク

# ネットワーク
alias myip="curl -s ifconfig.me"
alias localip="ipconfig getifaddr en0"
alias ips="echo 'Local:' && ipconfig getifaddr en0 && echo 'Global:' && curl -s ifconfig.me"
alias ports="lsof -i -P | grep LISTEN"

# ========================================
# zoxide（高速ディレクトリジャンプ）
# ========================================
alias j="z"                           # ディレクトリジャンプ
alias ji="zi"                         # インタラクティブ選択

# ========================================
# dotfiles管理
# ========================================
alias dotup="bash ~/dotfiles/scripts/check-updates.sh"    # 更新チェック
alias brewsync="bash ~/dotfiles/scripts/sync-brewfile.sh" # Brewfile同期チェック

# ========================================
# クイックアクセス
# ========================================
alias dots="cd ~/dotfiles"
alias projects="cd ~/Projects"
alias downloads="cd ~/Downloads"
alias desktop="cd ~/Desktop"

# ========================================
# ファイル表示 (bat)
# ========================================
alias cat="bat"                      # catをbatに置き換え
alias catp="bat -p"                  # プレーン表示（装飾なし）
alias catl="bat -l"                  # 言語指定 (例: catl json file.txt)
alias less="bat --paging=always"     # ページャーとして使用
alias bathelp="bat --help"           # batのヘルプ

# ファイルプレビュー (fzf + bat)
alias fp="fzf --preview 'bat --color=always --style=numbers --line-range=:500 {}'"
# fzfでファイル選択してnvimで開く（macOS互換）
fpe() {
  local file
  file=$(fzf --preview 'bat --color=always --style=numbers --line-range=:500 {}')
  [[ -n "$file" ]] && nvim "$file"
}

# ========================================
# AI駆動開発ツール
# ========================================

# ドキュメント閲覧
alias md="glow"                        # マークダウン表示
alias mdp="glow -p"                    # ページャーモード

# ファイル監視・自動実行（TDD用）
alias watch="watchexec"
alias watchtest="watchexec -e ts,js,py 'npm test'"

# コード統計
alias loc="tokei"                      # Lines of Code

# HTTPクライアント
alias http="https"                     # HTTPie（HTTPS優先）

# ========================================
# 便利関数
# ========================================

# ディレクトリ作成して移動
mkcd() { mkdir -p "$1" && cd "$1"; }

# ファイル作成して編集
touchedit() { touch "$1" && nvim "$1"; }

# ポート使用プロセス検索
port() { lsof -i :"$1"; }

# クリップボードのJSONを整形
jsonf() { pbpaste | jq '.' | pbcopy && pbpaste; }

# 天気表示
weather() { curl -s "wttr.in/${1:-Tokyo}?format=3"; }

# 詳細な天気
weatherfull() { curl -s "wttr.in/${1:-Tokyo}"; }

# Gitルートに移動
gitroot() { cd "$(git rev-parse --show-toplevel)"; }

# 一時ディレクトリで作業
tmpcd() { cd "$(mktemp -d)"; }

# base64エンコード/デコード
b64e() { echo -n "$1" | base64; }
b64d() { echo -n "$1" | base64 -d; }

# URLエンコード/デコード
urle() { python3 -c "import urllib.parse; print(urllib.parse.quote('$1'))"; }
urld() { python3 -c "import urllib.parse; print(urllib.parse.unquote('$1'))"; }

# パス内のコマンドを検索
pathfind() { echo $PATH | tr ':' '\n' | xargs -I {} find {} -name "*$1*" 2>/dev/null; }

# ========================================
# エイリアス管理
# ========================================
alias aliases="cat ~/.aliases"         # 全表示
alias aliasgrep="alias | grep"         # 検索
alias ag="alias | grep"                # 短縮版
alias af="alias | fzf"                 # fzfで対話的検索
